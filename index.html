<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Neon Tetris Quiz Ultra</title>
    <style>
        :root {
            --neon-blue: #00d2ff;
            --neon-pink: #ff007f;
            --neon-purple: #9d00ff;
            --bg-dark: #050510;
            --panel-glass: rgba(10, 15, 30, 0.8);
        }

        body {
            background-color: var(--bg-dark);
            color: #fff;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Плавный параллакс фон */
        #star-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #101525 0%, #050510 100%);
        }

        /* Контейнер игры */
        #main-container {
            display: flex;
            gap: 30px;
            padding: 30px;
            background: var(--panel-glass);
            border-radius: 30px;
            border: 1px solid rgba(0, 210, 255, 0.2);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(0, 210, 255, 0.1);
            backdrop-filter: blur(15px);
            position: relative;
        }

        /* Неоновое поле */
        #tetris {
            background: #000;
            border-radius: 10px;
            border: 2px solid rgba(0, 210, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.2);
        }

        .side-panel {
            width: 220px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--neon-blue);
            margin-bottom: 8px;
            font-weight: bold;
        }

        .value {
            font-size: 28px;
            font-weight: 800;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* Кнопки */
        .btn {
            padding: 15px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.3s;
        }

        .btn-primary {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .btn-danger {
            background: transparent;
            color: var(--neon-pink);
            border: 1px solid var(--neon-pink);
        }

        /* Оверлеи */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(5, 5, 20, 0.95);
            border-radius: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: 0.4s;
        }

        .overlay.active { opacity: 1; pointer-events: all; }

        /* Тряска при ошибке */
        .shake { animation: shakeAnim 0.4s ease-in-out; }
        @keyframes shakeAnim {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .quiz-option {
            width: 80%;
            padding: 15px;
            margin: 5px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .quiz-option:hover { background: rgba(0, 210, 255, 0.2); }

    </style>
</head>
<body>

<canvas id="star-layer"></canvas>

<div id="main-container">
    <canvas id="tetris" width="300" height="600"></canvas>

    <div class="side-panel">
        <div class="stat-card">
            <div class="label">СЛЕДУЮЩИЙ</div>
            <canvas id="next" width="100" height="100"></canvas>
        </div>
        <div class="stat-card">
            <div class="label">ВРЕМЯ</div>
            <div id="time-val" class="value">05:00</div>
        </div>
        <div class="stat-card">
            <div class="label">ОЧКИ</div>
            <div id="score-val" class="value">0</div>
        </div>
        
        <button class="btn btn-primary" onclick="resetGame()">МЕНЮ</button>
        <button class="btn btn-danger" onclick="window.close()">ВЫХОД</button>
    </div>

    <div id="quiz-overlay" class="overlay">
        <h2 id="q-text">Вопрос...</h2>
        <div id="q-options" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
    </div>

    <div id="menu-overlay" class="overlay active">
        <h1 style="font-size: 40px; text-shadow: 0 0 20px var(--neon-blue);">NEON QUIZ</h1>
        <p style="color: #666;">Выберите режим игры</p>
        <button class="btn btn-primary" onclick="start('timer')">⏱ СПРИНТ 5 МИН</button>
        <br>
        <button class="btn btn-danger" onclick="start('inf')">♾ БЕСКОНЕЧНО</button>
    </div>
</div>

<script>
/** --- ГРАФИКА: ПЛАВНЫЕ ЗВЕЗДЫ --- **/
const starCvs = document.getElementById('star-layer');
const starCtx = starCvs.getContext('2d');
let stars = [];

function initStars() {
    starCvs.width = window.innerWidth;
    starCvs.height = window.innerHeight;
    stars = [];
    for(let i=0; i<200; i++) {
        stars.push({
            x: Math.random() * starCvs.width,
            y: Math.random() * starCvs.height,
            size: Math.random() * 2,
            speed: Math.random() * 0.5 + 0.1, // Медленно
            opacity: Math.random()
        });
    }
}

function drawStars() {
    starCtx.clearRect(0, 0, starCvs.width, starCvs.height);
    stars.forEach(s => {
        starCtx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
        starCtx.beginPath();
        starCtx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        starCtx.fill();
        s.y += s.speed;
        if(s.y > starCvs.height) s.y = 0;
    });
    requestAnimationFrame(drawStars);
}

/** --- ГРАФИКА: НЕОНОВЫЙ ТЕТРИС --- **/
const cvs = document.getElementById('tetris');
const ctx = cvs.getContext('2d');
const nextCvs = document.getElementById('next');
const nextCtx = nextCvs.getContext('2d');

const COLORS = [null, '#FF007F', '#00FF7F', '#9D00FF', '#FFD700', '#00D2FF', '#FF8C00', '#007BFF'];

function drawBlock(c, x, y, colorIdx, size = 30) {
    if(!colorIdx) return;
    const color = colorIdx === -1 ? '#333' : COLORS[colorIdx];
    
    // Эффект свечения 
    c.shadowBlur = 15;
    c.shadowColor = color;
    
    c.fillStyle = color;
    c.roundRect ? c.beginPath() : null;
    c.fillRect(x * size + 2, y * size + 2, size - 4, size - 4);
    
    c.shadowBlur = 0;
    // Контур
    c.strokeStyle = 'white';
    c.lineWidth = 0.5;
    c.strokeRect(x * size + 2, y * size + 2, size - 4, size - 4);
}

/** --- ЛОГИКА ИГРЫ (Из ТЗ) --- **/
let arena = Array.from({length: 20}, () => Array(10).fill(0));
let player = { pos: {x: 0, y: 0}, matrix: null, score: 0 };
let gameRunning = false;
let paused = false;
let timer = 300;

function createPiece(type) {
    if (type === 'I') return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
    if (type === 'T') return [[0,3,0],[3,3,3],[0,0,0]];
    if (type === 'O') return [[4,4],[4,4]];
    // ... остальные фигуры
    return [[0,1,1],[1,1,0],[0,0,0]];
}

function start(mode) {
    document.getElementById('menu-overlay').classList.remove('active');
    arena = Array.from({length: 20}, () => Array(10).fill(0));
    player.score = 0;
    timer = mode === 'timer' ? 300 : -1;
    gameRunning = true;
    paused = false;
    resetPlayer();
    update();
    if(timer > 0) startTimer();
}

function startTimer() {
    let int = setInterval(() => {
        if(!gameRunning) clearInterval(int);
        if(!paused && timer > 0) {
            timer--;
            let m = Math.floor(timer/60);
            let s = timer%60;
            document.getElementById('time-val').innerText = `${m}:${s<10?'0':''}${s}`;
            if(timer === 0) endGame(true); [cite: 52]
        }
    }, 1000);
}

function resetPlayer() {
    player.matrix = createPiece('IOTSZ'[Math.random()*5|0]);
    player.pos.y = 0;
    player.pos.x = 4;
    if(collide()) endGame(false); [cite: 81]
}

function collide() {
    for(let y=0; y<player.matrix.length; y++) {
        for(let x=0; x<player.matrix[y].length; x++) {
            if(player.matrix[y][x] && (arena[y+player.pos.y] && arena[y+player.pos.y][x+player.pos.x]) !== 0) return true;
        }
    }
    return false;
}

function update(time = 0) {
    if(!gameRunning) return;
    if(!paused) {
        player.pos.y++;
        if(collide()) {
            player.pos.y--;
            merge();
            checkLines();
            resetPlayer();
        }
    }
    draw();
    setTimeout(() => requestAnimationFrame(update), 500);
}

function draw() {
    ctx.clearRect(0,0,300,600);
    arena.forEach((row, y) => row.forEach((v, x) => drawBlock(ctx, x, y, v)));
    player.matrix.forEach((row, y) => row.forEach((v, x) => drawBlock(ctx, x + player.pos.x, y + player.pos.y, v)));
}

function merge() {
    player.matrix.forEach((row, y) => {
        row.forEach((v, x) => {
            if(v) arena[y+player.pos.y][x+player.pos.x] = v;
        });
    });
}

function checkLines() {
    let lines = [];
    for(let y=19; y>=0; y--) {
        if(arena[y].every(v => v !== 0)) lines.push(y);
    }
    if(lines.length) triggerQuiz(lines); [cite: 30, 31]
}

function triggerQuiz(lines) {
    paused = true;
    const overlay = document.getElementById('quiz-overlay');
    overlay.classList.add('active');
    
    document.getElementById('q-text').innerText = "2 + 2 * 2 = ?";
    const opts = document.getElementById('q-options');
    opts.innerHTML = '';
    
    [6, 8].forEach(ans => {
        let b = document.createElement('div');
        b.className = 'quiz-option';
        b.innerText = ans;
        b.onclick = () => {
            if(ans === 6) {
                lines.forEach(y => {
                    arena.splice(y, 1);
                    arena.unshift(Array(10).fill(0));
                });
                player.score += 100;
                document.getElementById('score-val').innerText = player.score;
            } else {
                lines.forEach(y => arena[y] = arena[y].map(() => -1)); // Блокировка [cite: 42, 43]
                document.getElementById('main-container').classList.add('shake'); [cite: 116]
                setTimeout(() => document.getElementById('main-container').classList.remove('shake'), 400);
            }
            overlay.classList.remove('active');
            paused = false;
        };
        opts.appendChild(b);
    });
}

function endGame(win) {
    gameRunning = false;
    alert(win ? "ПОБЕДА!" : "ИГРА ОКОНЧЕНА"); [cite: 57]
    location.reload();
}

window.onload = () => {
    initStars();
    drawStars();
};

// Управление
document.addEventListener('keydown', e => {
    if(!gameRunning || paused) return;
    if(e.keyCode === 37) { player.pos.x--; if(collide()) player.pos.x++; }
    if(e.keyCode === 39) { player.pos.x++; if(collide()) player.pos.x--; }
    if(e.keyCode === 40) { player.pos.y++; if(collide()) player.pos.y--; }
});
</script>
</body>
</html>
