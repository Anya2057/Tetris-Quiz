<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Neon Tetris Designer + Global Styles</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050510; --panel: #0f172a; --blue: #00d2ff; --pink: #ff007f; --text: #e2e8f0;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Rajdhani', sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 850px; background: var(--panel); padding: 30px; border-radius: 20px; border: 1px solid rgba(0,210,255,0.3); box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        h1 { font-family: 'Orbitron'; color: var(--blue); text-align: center; margin-bottom: 30px; text-shadow: 0 0 10px var(--blue); }
        
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 30px; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; }
        
        /* –ë–ª–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è */
        .style-manager { 
            background: rgba(0, 210, 255, 0.1); border: 1px solid var(--blue); 
            padding: 15px; border-radius: 12px; margin-bottom: 25px; 
            display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;
        }

        .q-item { background: rgba(255,255,255,0.02); padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); position: relative; margin-bottom: 25px; }
        .btn-del-q { position: absolute; top: 10px; right: 10px; background: #ff4d4d22; border: 1px solid #ff4d4d; color: #ff4d4d; border-radius: 50%; cursor: pointer; width: 25px; height: 25px; }

        .editor-flex { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px; }
        .controls { flex: 1; min-width: 250px; }
        
        .preview-box { 
            width: 200px; height: 120px; border: 3px solid var(--blue); border-radius: 10px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px; text-align: center; background: #000; font-weight: bold;
        }
        .preview-label { font-size: 0.7rem; color: #666; margin-bottom: 5px; text-align: center; }

        .color-row { display: flex; gap: 15px; margin-top: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        .color-group { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        input[type="color"] { width: 25px; height: 25px; border: none; cursor: pointer; background: none; }

        input, select, textarea { width: 100%; padding: 10px; background: rgba(0,0,0,0.4); border: 1px solid #334155; color: white; border-radius: 8px; font-family: inherit; box-sizing: border-box; }
        .ans-row { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        
        .btn-main { width: 100%; padding: 18px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 15px; }
        .btn-add-q { background: transparent; border: 2px dashed var(--blue); color: var(--blue); }
        .btn-gen { background: linear-gradient(90deg, var(--blue), #0080ff); color: #000; font-size: 1.1rem; }
        
        .btn-style { background: var(--blue); color: #000; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        
        #output-section { margin-top: 20px; display: none; }
        #final-code { background: #000; color: #0f0; width: 100%; height: 100px; margin-top: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="container">
        <h1>TETRIS DESIGNER PRO</h1>

        <div class="settings-grid">
            <div><label>–†–µ–∂–∏–º</label><select id="mode"><option value="timer">Timer</option><option value="infinite">Survival</option></select></div>
            <div><label>–í—Ä–µ–º—è</label><input type="number" id="time" value="300"></div>
            <div><label>–°–∫–æ—Ä–æ—Å—Ç—å</label><select id="speed"><option value="800">Normal</option><option value="500">Fast</option></select></div>
            <div><label>–û—à–∏–±–∫–∏</label><input type="number" id="mistakes" value="5"></div>
        </div>

        <div class="style-manager">
            <span style="font-weight: bold; color: var(--blue);">üé® –ë–´–°–¢–†–´–ô –°–¢–ò–õ–¨:</span>
            <div class="color-group"><label>–¢–µ–∫—Å—Ç:</label><input type="color" id="global-text-color" value="#00d2ff"></div>
            <div class="color-group"><label>–†–∞–º–∫–∞:</label><input type="color" id="global-border-color" value="#00d2ff"></div>
            <button class="btn-style" onclick="applyGlobalStyle()">–ü–†–ò–ú–ï–ù–ò–¢–¨ –ö–û –í–°–ï–ú</button>
        </div>

        <div id="q-list"></div>
        <button class="btn-main btn-add-q" onclick="addQ()">+ –î–û–ë–ê–í–ò–¢–¨ –í–û–ü–†–û–°</button>
        <button class="btn-main btn-gen" onclick="generate()">üöÄ –ü–û–õ–£–ß–ò–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>

        <div id="output-section">
            <label>–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ –≤ Genially (Insert -> Others):</label>
            <textarea id="final-code" readonly></textarea>
        </div>
    </div>

<script>
    let qCount = 0;

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è
    function applyGlobalStyle() {
        const globalText = document.getElementById('global-text-color').value;
        const globalBorder = document.getElementById('global-border-color').value;
        
        document.querySelectorAll('.q-item').forEach(item => {
            item.querySelector('.q-color-text').value = globalText;
            item.querySelector('.q-color-border').value = globalBorder;
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞
            const id = item.id.split('-')[1];
            syncPreview(id);
        });
    }

    function addQ() {
        qCount++;
        const id = qCount;
        
        // –ë–µ—Ä–µ–º —Ç–µ–∫—É—â–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
        const currentGlobalText = document.getElementById('global-text-color').value;
        const currentGlobalBorder = document.getElementById('global-border-color').value;

        const div = document.createElement('div');
        div.className = 'q-item';
        div.id = `block-${id}`;
        div.innerHTML = `
            <button class="btn-del-q" onclick="this.parentElement.remove()">√ó</button>
            <div class="editor-flex">
                <div class="controls">
                    <label>–¢–∏–ø:</label>
                    <select class="q-type" onchange="updateView(${id}, this.value)">
                        <option value="choice">Multiple Choice</option>
                        <option value="write">Fill in Blank</option>
                        <option value="tf">True / False</option>
                        <option value="smalltalk">Small Talk</option>
                    </select>
                    <div style="margin:10px 0;">
                        <label>–í–æ–ø—Ä–æ—Å:</label>
                        <input type="text" class="q-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..." oninput="syncPreview(${id})">
                    </div>
                    <div class="color-row">
                        <div class="color-group"><label>–¢–µ–∫—Å—Ç:</label><input type="color" class="q-color-text" value="${currentGlobalText}" oninput="syncPreview(${id})"></div>
                        <div class="color-group"><label>–†–∞–º–∫–∞:</label><input type="color" class="q-color-border" value="${currentGlobalBorder}" oninput="syncPreview(${id})"></div>
                    </div>
                </div>
                
                <div>
                    <div class="preview-label">–ü–†–ï–î–ü–†–û–°–ú–û–¢–†</div>
                    <div id="preview-${id}" class="preview-box">
                        <span id="preview-text-${id}">Question Text?</span>
                    </div>
                </div>
            </div>

            <div id="ans-area-${id}" style="margin-top:15px;"></div>
            <button id="btn-add-ans-${id}" class="btn-main" style="padding:5px; font-size:0.8rem; background:none; border:1px solid var(--blue); color:var(--blue);" onclick="addAns(${id})">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
        `;
        document.getElementById('q-list').appendChild(div);
        updateView(id, 'choice');
    }

    function syncPreview(id) {
        const block = document.getElementById(`block-${id}`);
        if(!block) return;

        const text = block.querySelector('.q-text').value;
        const colorT = block.querySelector('.q-color-text').value;
        const colorB = block.querySelector('.q-color-border').value;
        
        const previewText = document.getElementById(`preview-text-${id}`);
        const previewBox = document.getElementById(`preview-${id}`);
        
        previewText.innerText = text || "Question Text?";
        previewText.style.color = colorT;
        previewBox.style.borderColor = colorB;
        previewBox.style.boxShadow = `0 0 15px ${colorB}66`;
    }

    function addAns(qId, txt="", isCorr=false) {
        const area = document.getElementById(`ans-area-${qId}`);
        const row = document.createElement('div');
        row.className = 'ans-row';
        row.innerHTML = `<input type="radio" name="corr-${qId}" class="radio" ${isCorr?'checked':''}> <input type="text" class="ans-input" value="${txt}" placeholder="–û—Ç–≤–µ—Ç..."> <button onclick="this.parentElement.remove()" style="color:red;background:none;border:none;">√ó</button>`;
        area.appendChild(row);
    }

    function updateView(id, type) {
        const area = document.getElementById(`ans-area-${id}`);
        const btn = document.getElementById(`btn-add-ans-${id}`);
        area.innerHTML = ''; btn.style.display = 'block';
        if(type==='tf') { addAns(id, "True", true); addAns(id, "False"); btn.style.display='none'; }
        else if(type==='write') { addAns(id, "", true); btn.style.display='none'; area.querySelector('.radio').style.display='none'; }
        else if(type==='smalltalk') { area.innerHTML='<i>–£—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç</i>'; btn.style.display='none'; }
        else { addAns(id); addAns(id); }
        syncPreview(id);
    }

    async function generate() {
        try {
            const res = await fetch('game.html');
            let template = await res.text();
            const config = {
                mode: document.getElementById('mode').value,
                time: parseInt(document.getElementById('time').value),
                speed: parseInt(document.getElementById('speed').value),
                maxMistakes: parseInt(document.getElementById('mistakes').value),
                questions: []
            };
            document.querySelectorAll('.q-item').forEach(item => {
                const ans = []; let corr = 0;
                item.querySelectorAll('.ans-row').forEach((r, i) => {
                    ans.push(r.querySelector('.ans-input').value);
                    if(r.querySelector('.radio').checked) corr = i;
                });
                config.questions.push({
                    type: item.querySelector('.q-type').value,
                    q: item.querySelector('.q-text').value,
                    colorText: item.querySelector('.q-color-text').value,
                    colorBorder: item.querySelector('.q-color-border').value,
                    a: ans, c: corr
                });
            });
            const script = `const CONFIG = ${JSON.stringify(config)};`;
            template = template.replace(/const\s+CONFIG\s*=\s*\{[\s\S]*?\};/, script);
            const output = document.getElementById('final-code');
            output.value = `<iframe srcdoc='${template.replace(/'/g, "&#39;")}' width="100%" height="750px" frameborder="0"></iframe>`;
            document.getElementById('output-section').style.display = 'block';
            output.select();
        } catch(e) { alert("–û—à–∏–±–∫–∞: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ game.html –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ."); }
    }
    addQ();
</script>
</body>
</html>